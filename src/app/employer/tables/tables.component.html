<div class="p-6 bg-gray-50 min-h-screen" data-aos="fade-up">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight">Table Management</h1>
            <p class="text-gray-500 mt-1">Organize your restaurant layout and assign staff.</p>
        </div>
        <div class="flex gap-3">
            <button mat-icon-button (click)="loadData()" [disabled]="loading" matTooltip="Refresh list">
                <mat-icon [class.animate-spin]="loading">refresh</mat-icon>
            </button>
            <button mat-raised-button color="primary" (click)="openTableDialog()"
                class="rounded-lg px-6 py-2 shadow-md hover:shadow-lg transition-all transform hover:scale-105 active:scale-95">
                <mat-icon class="mr-2">add</mat-icon>
                Add Table
            </button>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && tables.length === 0"
        class="flex flex-col items-center justify-center p-12 bg-white rounded-2xl shadow-sm border-2 border-dashed border-gray-200"
        data-aos="zoom-in">
        <div class="bg-blue-50 p-6 rounded-full mb-4">
            <mat-icon class="text-blue-500 scale-150">table_restaurant</mat-icon>
        </div>
        <h3 class="text-xl font-bold text-gray-900 mb-2">No Tables Found</h3>
        <p class="text-gray-500 text-center max-w-sm mb-6">
            Get started by adding your first restaurant table and assigning it to your staff.
        </p>
        <button mat-raised-button color="primary" (click)="openTableDialog()">
            Create First Table
        </button>
    </div>

    <!-- Table Grid -->
    <div *ngIf="tables.length > 0" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <mat-card *ngFor="let table of tables; let i = index"
            class="table-card overflow-hidden hover:shadow-xl transition-all border-0 rounded-2xl"
            [attr.data-aos]="'fade-up'" [attr.data-aos-delay]="i * 50">

            <!-- Card Header: Table Number & Status -->
            <div class="p-5 flex justify-between items-start border-b border-gray-100">
                <div class="flex items-center">
                    <div
                        class="w-12 h-12 rounded-xl bg-blue-600 flex items-center justify-center text-white mr-3 shadow-lg shadow-blue-100">
                        <span class="text-xl font-bold text-white">{{ table.table_number }}</span>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-900">Table {{ table.table_number }}</h3>
                        <p class="text-xs text-gray-500">Capacity: {{ table.capacity }} persons</p>
                    </div>
                </div>
                <div
                    [class]="'px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider border ' + getStatusClass(table.status || 'available')">
                    {{ table.status }}
                </div>
            </div>

            <!-- Card Content: Assignment -->
            <div class="p-5">
                <div class="mb-4">
                    <p class="text-xs font-semibold text-gray-400 uppercase tracking-widest mb-2">Assigned Staff</p>
                    <div *ngIf="table.assigned_employee"
                        class="flex items-center bg-gray-50 p-3 rounded-xl border border-gray-100">
                        <div
                            class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs mr-3">
                            {{ table.assigned_employee.username.charAt(0).toUpperCase() }}
                        </div>
                        <div class="overflow-hidden">
                            <p class="text-sm font-bold text-gray-900 truncate">{{ table.assigned_employee.username }}
                            </p>
                            <p class="text-xs text-gray-500 truncate">{{ table.assigned_employee.role }}</p>
                        </div>
                    </div>
                    <div *ngIf="!table.assigned_employee"
                        class="flex items-center p-3 rounded-xl border-2 border-dashed border-gray-100 text-gray-400 italic text-sm">
                        <mat-icon class="mr-2 text-gray-300">person_off</mat-icon>
                        Unassigned
                    </div>
                </div>

                <!-- Fast Status Toggle -->
                <div class="flex gap-2 mb-4">
                    <button mat-stroked-button color="primary" class="flex-1 text-xs px-0 rounded-lg min-w-0"
                        [disabled]="table.status === 'available'" (click)="updateTableStatus(table, 'available')">
                        Make Avail.
                    </button>
                    <button mat-stroked-button color="warn" class="flex-1 text-xs px-0 rounded-lg min-w-0"
                        [disabled]="table.status === 'occupied'" (click)="updateTableStatus(table, 'occupied')">
                        Occupy
                    </button>
                </div>
            </div>

            <!-- Action Bar -->
            <div class="px-5 py-4 bg-gray-50/50 flex justify-between items-center border-t border-gray-100">
                <div class="flex gap-1">
                    <button mat-icon-button color="primary" (click)="openTableDialog(table)" matTooltip="Edit table">
                        <mat-icon class="text-blue-600">edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" (click)="deleteTable(table)" matTooltip="Remove table">
                        <mat-icon>delete_outline</mat-icon>
                    </button>
                </div>
                <button mat-button class="text-blue-600 font-bold" (click)="openTableDialog(table)">
                    MANAGE
                </button>
            </div>
        </mat-card>
    </div>

    <!-- Loading Overlay -->
    <div *ngIf="loading && tables.length === 0" class="flex flex-col items-center justify-center p-24">
        <div class="w-16 h-16 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin"></div>
        <p class="mt-4 text-gray-500 font-medium">Loading your tables...</p>
    </div>
</div>